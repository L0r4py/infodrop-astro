---
/*
 * ContextTicker.astro - Version optimis√©e de votre original
 * Garde votre excellente logique de duplication et ajoute des am√©liorations
 */
---

<div
    x-data="{
        date: '', day: 0, temp: null, wIcon: '', wText: '',
        moon: '', left: 0, btc: null, eth: null
    }"
    x-init="
        initTicker($data);

        /* Votre excellente logique de duplication - conserv√©e ! */
        $nextTick(() => {
            const track = $el.querySelector('.ticker-track');
            track.innerHTML += track.innerHTML;          // premier doublon
            while (track.offsetWidth < $el.offsetWidth * 2) {
                track.innerHTML += track.innerHTML;        // s√©curit√© pour tr√®s larges √©crans
            }
        });
    "
    class="w-full bg-gray-800/60 backdrop-blur-sm text-[15px] border-b border-gray-700 overflow-hidden"
    role="banner"
    aria-label="Informations contextuelles en temps r√©el"
>
    <!-- PISTE QUI D√âFILE - Votre logique conserv√©e et am√©lior√©e -->
    <div
        class="ticker-track inline-flex gap-x-6 items-center px-4 py-1"
        x-data="{ paused: false }"
        :class="{ 'paused': paused }"
        @click="paused = !paused"
        @keydown.space.prevent="paused = !paused"
        tabindex="0"
        role="button"
        :aria-label="paused ? 'Reprendre le d√©filement' : 'Mettre en pause le d√©filement'"
        title="Cliquez pour mettre en pause/reprendre le d√©filement"
    >
        <!-- Lune avec accessibilit√© am√©lior√©e -->
        <span class="flex items-center gap-1" :title="`Phase lunaire: ${moon}`">
            <span x-text="moon" aria-hidden="true"></span>
        </span>

        <!-- Jour ordinal avec contexte -->
        <span class="flex items-center gap-1" title="Progression de l'ann√©e">
            <span class="text-blue-400" aria-hidden="true">üìä</span>
            <span class="sr-only">Jour</span>
            <span
                >Jour <span x-text="day" class="font-semibold text-white"
                ></span>/365</span
            >
        </span>

        <!-- Compteur 2026 avec urgence visuelle -->
        <span
            class="flex items-center gap-1"
            title="Compte √† rebours vers 2026"
        >
            <span class="text-green-400" aria-hidden="true">‚è≥</span>
            <span x-text="left" class="font-semibold text-white"></span> jours avant
            2026
        </span>

        <!-- Crypto BTC/USD avec lien vers graphique - Votre id√©e g√©niale ! -->
        <a
            href="https://www.tradingview.com/chart/?symbol=BINANCE:BTCUSD"
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-1 no-underline hover:text-blue-400 transition cursor-pointer focus-ring rounded-sm px-1"
            title="Voir le graphique BTC/USD sur TradingView"
            x-show="btc !== null"
        >
            <span class="text-lg" aria-hidden="true">ü™ô</span>
            <span class="sr-only">Bitcoin prix:</span>
            <span>BTC/USD </span>
            <span
                x-text="btc !== null ? btc.toLocaleString('fr-FR') + ' $' : '‚Ä¶'"
                class="font-semibold text-white"></span>
        </a>

        <!-- Crypto ETH/USD avec lien -->
        <a
            href="https://www.tradingview.com/chart/?symbol=BINANCE:ETHUSD"
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-1 no-underline hover:text-purple-400 transition cursor-pointer focus-ring rounded-sm px-1"
            title="Voir le graphique ETH/USD sur TradingView"
            x-show="eth !== null"
        >
            <span class="text-lg" aria-hidden="true">‚ô¶Ô∏è</span>
            <span class="sr-only">Ethereum prix:</span>
            <span>ETH/USD </span>
            <span
                x-text="eth !== null ? eth.toLocaleString('fr-FR') + ' $' : '‚Ä¶'"
                class="font-semibold text-white"></span>
        </a>

        <!-- Date compl√®te -->
        <span
            class="flex items-center gap-1"
            x-show="date"
            title="Date actuelle"
        >
            <span class="text-yellow-400" aria-hidden="true">üìÖ</span>
            <span x-text="date"></span>
        </span>

        <!-- M√©t√©o avec plus de d√©tails -->
        <span
            x-show="temp !== null"
            class="flex items-center gap-1"
            :title="`M√©t√©o: ${temp}¬∞C - ${wText}`"
        >
            <span x-text="wIcon" aria-hidden="true"></span>
            <span class="sr-only">Temp√©rature:</span>
            <span x-text="temp" class="font-semibold text-white"></span>¬∞C
            <span x-text="wText" class="text-gray-300"></span>
        </span>

        <!-- Indicateur de statut en temps r√©el -->
        <span
            class="flex items-center gap-1 text-xs"
            title="Donn√©es mises √† jour en temps r√©el"
        >
            <div
                class="w-2 h-2 bg-green-400 rounded-full animate-pulse"
                aria-hidden="true"
            >
            </div>
            <span class="text-gray-400">Live</span>
        </span>
    </div>

    <!-- Contr√¥les d'accessibilit√© cach√©s -->
    <div class="sr-only">
        <p>
            Bandeau d'informations d√©filant. Appuyez sur Espace ou cliquez pour
            mettre en pause.
        </p>
    </div>
</div>

<style>
    /* Votre animation conserv√©e avec am√©liorations */
    .ticker-track {
        white-space: nowrap;
        animation: ticker-scroll 40s linear infinite;
    }

    .ticker-track:hover,
    .ticker-track.paused {
        animation-play-state: paused;
        cursor: pointer;
    }

    .ticker-track:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }

    .ticker-track span {
        white-space: nowrap;
    }

    @keyframes ticker-scroll {
        from {
            transform: translateX(0);
        }
        to {
            transform: translateX(-50%);
        }
    }

    /* Am√©lioration pour la r√©duction de mouvement */
    @media (prefers-reduced-motion: reduce) {
        .ticker-track {
            animation-duration: 120s; /* Plus lent pour les utilisateurs sensibles au mouvement */
        }
    }

    /* Optimisation pour les petits √©crans */
    @media (max-width: 640px) {
        .ticker-track {
            font-size: 14px;
            gap: 1rem;
        }
    }

    /* Focus am√©lior√© pour l'accessibilit√© */
    .focus-ring:focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
        border-radius: 4px;
    }
</style>
